<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Taming IO - Battle Royale</title>
    <script src="https://pixijs.download/v8.x/pixi.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pixi/sound@5.2.2/dist/pixi-sound.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #1099bb; font-family: 'Arial Black', sans-serif; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; text-shadow: 2px 2px #000; pointer-events: none; }
        .menu { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        .btn { padding: 15px 25px; border: 3px solid #fff; border-radius: 10px; color: white; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .ak { background: #d35400; } .sniper { background: #2980b9; } .mg { background: #27ae60; }
        #start { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 100; }
    </style>
</head>
<body>

    <div id="start">
        <button class="btn mg" onclick="setup()">¬°EMPEZAR PARTIDA!</button>
    </div>

    <div id="ui">üí∞ ORO: $50 | ‚ù§Ô∏è VIDA: 100%</div>

    <div class="menu">
        <div class="btn ak" onclick="cambiarArma('AK')">AK-47</div>
        <div class="btn sniper" onclick="cambiarArma('SNIPER')">SNIPER</div>
        <div class="btn mg" onclick="cambiarArma('MG')">MG</div>
    </div>

    <script>
        const app = new PIXI.Application();
        let jugador, armaVisual, balas = [], zombies = [];
        let armaActual = 'AK';

        async function setup() {
            document.getElementById('start').style.display = 'none';
            await app.init({ background: '#1099bb', resizeTo: window });
            document.body.appendChild(app.canvas);

            // Sonidos
            PIXI.sound.add('bg', 'musica_fondo.mp3');
            PIXI.sound.add('shot', 'disparo.mp3');
            PIXI.sound.play('bg', { loop: true, volume: 0.1 });

            // --- CREACI√ìN DEL PERSONAJE ---
            jugador = new PIXI.Container();
            jugador.x = window.innerWidth / 2;
            jugador.y = window.innerHeight / 2;
            app.stage.addChild(jugador);

            const cuerpo = new PIXI.Graphics().beginFill(0xee8033).lineStyle(4, 0x000000).drawCircle(0, 0, 30).endFill();
            
            // Manos integradas al contenedor para que roten con √©l
            const manoL = new PIXI.Graphics().beginFill(0xee8033).lineStyle(3, 0x000000).drawCircle(-25, 20, 10).endFill();
            const manoR = new PIXI.Graphics().beginFill(0xee8033).lineStyle(3, 0x000000).drawCircle(25, 20, 10).endFill();

            // Arma visual (un rect√°ngulo que sale de la mano derecha)
            armaVisual = new PIXI.Graphics().beginFill(0x333333).drawRect(20, 10, 40, 10).endFill();

            jugador.addChild(cuerpo, manoL, manoR, armaVisual);

            // --- EVENTO DE DISPARO ---
            window.addEventListener('mousedown', disparar);

            app.ticker.add(update);
            spawnZombies();
        }

        function cambiarArma(tipo) {
            armaActual = tipo;
            armaVisual.clear();
            if(tipo === 'AK') armaVisual.beginFill(0x555555).drawRect(20, 10, 45, 12).endFill();
            if(tipo === 'SNIPER') armaVisual.beginFill(0x222222).drawRect(20, 10, 70, 8).endFill();
            if(tipo === 'MG') armaVisual.beginFill(0x27ae60).drawRect(20, 5, 50, 20).endFill();
        }

        function disparar() {
            PIXI.sound.play('shot', { volume: 0.3 });
            const b = new PIXI.Graphics().beginFill(0xFFFF00).drawCircle(0, 0, 5).endFill();
            b.x = jugador.x; b.y = jugador.y;
            
            const angle = jugador.rotation + Math.PI/2;
            const speed = armaActual === 'SNIPER' ? 25 : 15;
            b.vx = Math.cos(angle) * speed;
            b.vy = Math.sin(angle) * speed;
            
            app.stage.addChild(b);
            balas.push(b);
        }

        function spawnZombies() {
            setInterval(() => {
                const z = new PIXI.Graphics().beginFill(0x2ecc71).lineStyle(3, 0x000000).drawCircle(0, 0, 25).endFill();
                z.x = Math.random() > 0.5 ? -50 : window.innerWidth + 50;
                z.y = Math.random() * window.innerHeight;
                app.stage.addChild(z);
                zombies.push(z);
            }, 2000);
        }

        function update() {
            const mouse = app.renderer.events.pointer;
            jugador.rotation = Math.atan2(mouse.y - jugador.y, mouse.x - jugador.x) - Math.PI/2;

            // Mover balas y limpiar
            balas.forEach((b, i) => {
                b.x += b.vx; b.y += b.vy;
                if(b.x < 0 || b.x > window.innerWidth || b.y < 0 || b.y > window.innerHeight) {
                    app.stage.removeChild(b); balas.splice(i, 1);
                }
            });

            // Mover zombies y colisiones
            zombies.forEach((z, zi) => {
                const ang = Math.atan2(jugador.y - z.y, jugador.x - z.x);
                z.x += Math.cos(ang) * 1.5;
                z.y += Math.sin(ang) * 1.5;

                balas.forEach((b, bi) => {
                    if(Math.hypot(z.x - b.x, z.y - b.y) < 30) {
                        app.stage.removeChild(z); zombies.splice(zi, 1);
                        app.stage.removeChild(b); balas.splice(bi, 1);
                    }
                });
            });
        }
    </script>
</body>
</html>
