<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ZOMBIE SURVIVAL - BATTLE STYLE</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #222; font-family: 'Verdana', sans-serif; }
        canvas { display: none; background: #3d3d3d; cursor: crosshair; }
        
        #menu { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: white; background: radial-gradient(circle, #2c3e50 0%, #000 100%);
        }

        .btn {
            background: #f1c40f; border: none; padding: 15px; color: #333;
            font-weight: bold; font-size: 18px; cursor: pointer; border-radius: 5px; 
            margin: 10px; width: 280px; border-bottom: 5px solid #f39c12;
        }

        #ui-juego { position: absolute; top: 20px; left: 20px; color: white; display: none; pointer-events: none; }
        .hud-item { background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; margin-bottom: 5px; border: 2px solid #555; }
        #vida-bar { width: 100%; height: 15px; background: #2ecc71; border-radius: 10px; transition: 0.2s; }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="font-size: 50px; text-shadow: 3px 3px #000;">ZOMBIES.IO</h1>
        <div style="background: rgba(0,0,0,0.5); padding: 30px; border-radius: 10px; border: 3px solid #f1c40f;">
            <h2 style="color: #f1c40f;">ORO: <span id="banco-total">0</span></h2>
            <button class="btn" onclick="empezarJuego()">JUGAR (MAPA ABIERTO)</button><br>
            <button class="btn" style="background: #e74c3c; border-color: #c0392b; color: white;" onclick="comprar('shotgun', 200)">DESBLOQUEAR ESCOPETA ($200)</button>
        </div>
    </div>

    <div id="ui-juego">
        <div class="hud-item">
            <div style="color: #f1c40f; font-weight: bold;">MONEDAS: <span id="puntos">0</span></div>
            <div style="width: 200px; height: 15px; background: #444; border-radius: 10px; margin-top: 5px;">
                <div id="vida-bar"></div>
            </div>
            <div id="arma-txt" style="font-size: 12px; margin-top: 5px;">EQUIPADO: PISTOLA</div>
        </div>
    </div>

    <canvas id="juego"></canvas>

    <script>
        const canvas = document.getElementById("juego");
        const ctx = canvas.getContext("2d");
        const MUNDO = 3000;
        let banco = parseInt(localStorage.getItem("banco_io")) || 0;
        let armaActual = localStorage.getItem("arma_equipada") || "pistola";

        document.getElementById("banco-total").innerText = banco;

        let enJuego = false, jugador, zombies = [], balas = [], arbustos = [], teclas = {};
        let mouseX = 0, mouseY = 0, camara = { x: 0, y: 0 };

        // Configuración de Armas estilo BattleDudes
        const ARMAS = {
            pistola: { cadencia: 400, daño: 25, bVel: 15, color: "#7f8c8d", largo: 25 },
            shotgun: { cadencia: 800, daño: 15, bVel: 12, color: "#d35400", largo: 35, perdigones: 5 },
            ak47: { cadencia: 110, daño: 20, bVel: 18, color: "#27ae60", largo: 40 },
            sniper: { cadencia: 1000, daño: 100, bVel: 30, color: "#2980b9", largo: 55 }
        };

        function empezarJuego() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            enJuego = true;
            document.getElementById("menu").style.display = "none";
            canvas.style.display = "block";
            document.getElementById("ui-juego").style.display = "block";

            jugador = { 
                x: MUNDO/2, y: MUNDO/2, r: 25, 
                vida: 100, puntos: 0, vel: 5, 
                arma: armaActual, oculto: false 
            };

            for(let i=0; i<20; i++) arbustos.push({ x: Math.random()*MUNDO, y: Math.random()*MUNDO, r: 80 });
            for(let i=0; i<25; i++) spawnZombie();
            
            requestAnimationFrame(bucle);
        }

        function spawnZombie() {
            zombies.push({ x: Math.random()*MUNDO, y: Math.random()*MUNDO, r: 25, vel: 2 + Math.random() });
        }

        window.addEventListener("keydown", (e) => teclas[e.key.toLowerCase()] = true);
        window.addEventListener("keyup", (e) => teclas[e.key.toLowerCase()] = false);
        window.addEventListener("mousemove", (e) => { mouseX = e.clientX; mouseY = e.clientY; });
        
        let lastShot = 0;
        window.addEventListener("mousedown", () => {
            if(!enJuego) return;
            let ahora = Date.now();
            let a = ARMAS[jugador.arma];
            if(ahora - lastShot > a.cadencia) {
                let ang = Math.atan2((mouseY + camara.y) - jugador.y, (mouseX + camara.x) - jugador.x);
                
                if(jugador.arma === "shotgun") {
                    for(let i=-2; i<=2; i++) {
                        balas.push({ x: jugador.x, y: jugador.y, vx: Math.cos(ang+(i*0.1))*a.bVel, vy: Math.sin(ang+(i*0.1))*a.bVel, t: jugador.arma });
                    }
                } else {
                    balas.push({ x: jugador.x, y: jugador.y, vx: Math.cos(ang)*a.bVel, vy: Math.sin(ang)*a.bVel, t: jugador.arma });
                }
                lastShot = ahora;
            }
        });

        function actualizar() {
            if (teclas["w"] && jugador.y > 0) jugador.y -= jugador.vel;
            if (teclas["s"] && jugador.y < MUNDO) jugador.y += jugador.vel;
            if (teclas["a"] && jugador.x > 0) jugador.x -= jugador.vel;
            if (teclas["d"] && jugador.x < MUNDO) jugador.x += jugador.vel;

            camara.x = jugador.x - canvas.width / 2;
            camara.y = jugador.y - canvas.height / 2;

            jugador.oculto = false;
            arbustos.forEach(arb => {
                if(Math.hypot(jugador.x - arb.x, jugador.y - arb.y) < arb.r) jugador.oculto = true;
            });

            zombies.forEach((z, i) => {
                let d = Math.hypot(jugador.x - z.x, jugador.y - z.y);
                if(!jugador.oculto) {
                    z.x += (jugador.x - z.x)/d * z.vel;
                    z.y += (jugador.y - z.y)/d * z.vel;
                }
                if(d < jugador.r + z.r) {
                    jugador.vida -= 0.5;
                    document.getElementById("vida-bar").style.width = jugador.vida + "%";
                    if(jugador.vida <= 0) morir();
                }
            });

            balas.forEach((b, bi) => {
                b.x += b.vx; b.y += b.vy;
                zombies.forEach((z, zi) => {
                    if(Math.hypot(b.x - z.x, b.y - z.y) < z.r) {
                        jugador.puntos += 10;
                        document.getElementById("puntos").innerText = jugador.puntos;
                        zombies.splice(zi, 1);
                        if(b.t !== "sniper") balas.splice(bi, 1);
                        spawnZombie();
                    }
                });
            });
        }

        function dibujar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(-camara.x, -camara.y);

            // Suelo (Estilo BattleDudes)
            ctx.fillStyle = "#444";
            ctx.fillRect(0,0, MUNDO, MUNDO);

            // Arbustos
            arbustos.forEach(a => {
                ctx.fillStyle = "#27ae60";
                ctx.beginPath(); ctx.arc(a.x, a.y, a.r, 0, Math.PI*2); ctx.fill();
            });

            // Zombies (Estilo Taming.io - círculo con borde)
            zombies.forEach(z => {
                ctx.fillStyle = "#eb4d4b"; ctx.strokeStyle = "#000"; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.arc(z.x, z.y, z.r, 0, Math.PI*2); ctx.fill(); ctx.stroke();
            });

            // Jugador y Arma
            let ang = Math.atan2((mouseY + camara.y) - jugador.y, (mouseX + camara.x) - jugador.x);
            
            // Dibujar Arma
            ctx.save();
            ctx.translate(jugador.x, jugador.y);
            ctx.rotate(ang);
            ctx.fillStyle = ARMAS[jugador.arma].color;
            ctx.strokeStyle = "#000"; ctx.lineWidth = 2;
            ctx.fillRect(10, -5, ARMAS[jugador.arma].largo, 10);
            ctx.strokeRect(10, -5, ARMAS[jugador.arma].largo, 10);
            ctx.restore();

            // Dibujar Cuerpo (Taming.io Style)
            ctx.globalAlpha = jugador.oculto ? 0.4 : 1;
            ctx.fillStyle = "#3498db"; ctx.strokeStyle = "#000"; ctx.lineWidth = 5;
            ctx.beginPath(); ctx.arc(jugador.x, jugador.y, jugador.r, 0, Math.PI*2); ctx.fill(); ctx.stroke();
            ctx.globalAlpha = 1;

            // Balas
            balas.forEach(b => {
                ctx.fillStyle = "#f1c40f";
                ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.fill();
            });

            ctx.restore();
        }

        function morir() {
            enJuego = false;
            banco += jugador.puntos;
            localStorage.setItem("banco_io", banco);
            alert("FIN DE LA PARTIDA. ORO GANADO: " + jugador.puntos);
            location.reload();
        }

        function comprar(arma, precio) {
            if(banco >= precio) {
                banco -= precio;
                localStorage.setItem("banco_io", banco);
                localStorage.setItem("arma_equipada", arma);
                location.reload();
            } else { alert("FALTA ORO"); }
        }

        function bucle() { if(enJuego) { actualizar(); dibujar(); requestAnimationFrame(bucle); } }
    </script>
</body>
</html>
