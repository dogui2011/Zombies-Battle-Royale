<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Taming IO - Ultimate Replica</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Verdana', sans-serif; user-select: none; }
        
        /* MEN칔S */
        .overlay {
            position: absolute; width: 100%; height: 100%; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10;
            background: radial-gradient(circle, #1099bb 0%, #0a5d71 100%);
        }
        
        #pantalla-descanso { display: none; background: rgba(0,0,0,0.9); color: white; }

        /* TIENDA EN DESCANSO */
        .tienda-container {
            background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;
            display: flex; gap: 20px; margin-top: 20px; border: 2px solid #f1c40f;
        }
        .item-tienda { text-align: center; }
        .btn-buy { background: #f1c40f; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* UI JUEGO */
        #hud { position: absolute; top: 20px; left: 20px; color: white; font-weight: bold; font-size: 20px; display: none; text-shadow: 2px 2px black; }
        #selector-armas { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: none; gap: 10px; }
        .arma-btn { width: 80px; height: 80px; border-radius: 10px; border: 4px solid #fff; cursor: pointer; color: white; font-weight: bold; }
        .selected { border-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; }
    </style>
</head>
<body>

    <div id="pantalla-inicio" class="overlay">
        <h1 style="color:white; font-size:60px; text-shadow: 4px 4px #d35400;">TAMING REPLICA</h1>
        <button class="btn-buy" style="padding: 20px 80px; font-size: 25px;" onclick="comenzarJuego()">춰A BATALLAR!</button>
    </div>

    <div id="pantalla-descanso" class="overlay">
        <h1>HAS MUERTO</h1>
        <h2 id="oro-final">ORO TOTAL: $0</h2>
        <div class="tienda-container">
            <div class="item-tienda">
                <p>M츼S VIDA</p>
                <button class="btn-buy" onclick="comprarMejora('vida')">COMPRAR ($100)</button>
            </div>
            <div class="item-tienda">
                <p>DA칌O X2</p>
                <button class="btn-buy" onclick="comprarMejora('da침o')">COMPRAR ($250)</button>
            </div>
        </div>
        <button class="btn-buy" style="margin-top:30px; padding:15px 40px;" onclick="location.reload()">VOLVER A JUGAR</button>
    </div>

    <div id="hud">游눯 ORO: $<span id="oro-txt">0</span> | 仇벒잺 VIDA: <span id="vida-txt">100</span>%</div>
    
    <div id="selector-armas">
        <button id="btn-AK47" class="arma-btn" style="background: #d35400;" onclick="seleccionarArma('AK47')">AK-47</button>
        <button id="btn-SNIPER" class="arma-btn" style="background: #2980b9;" onclick="seleccionarArma('SNIPER')">SNIPER</button>
        <button id="btn-MG" class="arma-btn" style="background: #27ae60;" onclick="seleccionarArma('MG')">MG</button>
    </div>

    <script src="https://pixijs.download/release/pixi.js"></script>
    <script>
        let app, player, world, weaponGraphic;
        let juegoIniciado = false;
        let armaActual = 'AK47';
        let oroTotal = parseInt(localStorage.getItem('oro')) || 0;
        let vidaMax = 100;
        let vidaActual = 100;

        async function comenzarJuego() {
            document.getElementById('pantalla-inicio').style.display = 'none';
            document.getElementById('hud').style.display = 'block';
            document.getElementById('selector-armas').style.display = 'flex';
            juegoIniciado = true;
            await iniciarPixi();
            seleccionarArma('AK47');
        }

        function seleccionarArma(tipo) {
            armaActual = tipo;
            document.querySelectorAll('.arma-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('btn-' + tipo).classList.add('selected');
            dibujarArmaFisica();
        }

        function dibujarArmaFisica() {
            if(!weaponGraphic) return;
            weaponGraphic.clear();
            
            // Colores de armas
            let color = 0x555555;
            let largo = 40;
            
            if(armaActual === 'AK47') { color = 0x8b4513; largo = 45; }
            if(armaActual === 'SNIPER') { color = 0x2c3e50; largo = 65; }
            if(armaActual === 'MG') { color = 0x27ae60; largo = 35; }

            // Dibujar el ca침칩n saliendo de la mano derecha
            weaponGraphic.rect(25, 10, largo, 12)
                         .fill(color)
                         .stroke({width: 2, color: 0x000000});
        }

        async function iniciarPixi() {
            app = new PIXI.Application();
            await app.init({ background: '#1099bb', resizeTo: window });
            document.body.appendChild(app.canvas);

            world = new PIXI.Container();
            app.stage.addChild(world);

            // JUGADOR
            player = new PIXI.Container();
            const body = new PIXI.Graphics().circle(0, 0, 25).fill(0xe67e22).stroke({width:3, color:0x000000});
            const hL = new PIXI.Graphics().circle(-30, 15, 8).fill(0xd35400).stroke({width:2, color:0x000000});
            const hR = new PIXI.Graphics().circle(30, 15, 8).fill(0xd35400).stroke({width:2, color:0x000000});
            
            weaponGraphic = new PIXI.Graphics();
            
            player.addChild(weaponGraphic, body, hL, hR);
            player.x = 500; player.y = 500;
            world.addChild(player);

            // ZOMBIES
            const zombies = [];
            for(let i=0; i<15; i++) {
                const z = new PIXI.Graphics().circle(0, 0, 20).fill(0x2ecc71).stroke({width:2, color:0x000000});
                z.x = Math.random() * 2000; z.y = Math.random() * 2000;
                zombies.push(z); world.addChild(z);
            }

            const keys = {};
            window.addEventListener('keydown', e => keys[e.code] = true);
            window.addEventListener('keyup', e => keys[e.code] = false);

            app.ticker.add((delta) => {
                if(!juegoIniciado) return;

                const speed = 5 * delta.deltaTime;
                if(keys['KeyW']) player.y -= speed;
                if(keys['KeyS']) player.y += speed;
                if(keys['KeyA']) player.x -= speed;
                if(keys['KeyD']) player.x += speed;

                // C치mara
                world.x = -player.x + app.screen.width / 2;
                world.y = -player.y + app.screen.height / 2;

                // Colisi칩n Zombies
                zombies.forEach(z => {
                    const dx = player.x - z.x; const dy = player.y - z.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 500) {
                        z.x += (dx/dist) * 2; z.y += (dy/dist) * 2;
                        if(dist < 40) {
                            vidaActual -= 0.5;
                            document.getElementById('vida-txt').innerText = Math.floor(vidaActual);
                            if(vidaActual <= 0) morir();
                        }
                    }
                });
                
                document.getElementById('oro-txt').innerText = oroTotal;
            });

            app.stage.eventMode = 'static';
            app.stage.on('pointermove', (e) => {
                player.rotation = Math.atan2(e.global.y - app.screen.height/2, e.global.x - app.screen.width/2) + Math.PI/2;
            });
        }

        function morir() {
            juegoIniciado = false;
            localStorage.setItem('oro', oroTotal);
            document.getElementById('oro-final').innerText = "ORO TOTAL: $" + oroTotal;
            document.getElementById('pantalla-descanso').style.display = 'flex';
        }

        function comprarMejora(tipo) {
            if(oroTotal >= 100) {
                oroTotal -= 100;
                alert("Mejora de " + tipo + " comprada!");
                localStorage.setItem('oro', oroTotal);
            } else {
                alert("No tienes suficiente oro, bro!");
            }
        }
    </script>
</body>
</html>
