<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ZOMBIES BR - Official</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; }
        canvas { display: none; background: #0b0b0b; cursor: crosshair; }
        
        /* MENU PRINCIPAL */
        #menu { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: white; text-align: center;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), 
                        url('https://img.freepik.com/vector-gratis/personaje-dibujos-animados-zombie-estilo-plano-diseno_23-2149114675.jpg');
            background-size: cover; background-position: center;
        }

        .btn {
            background: #2ecc71; border: none; padding: 15px 40px; color: white;
            font-size: 24px; cursor: pointer; border-radius: 8px; margin: 10px;
            transition: 0.2s; border-bottom: 5px solid #27ae60; text-transform: uppercase;
        }
        .btn:hover { background: #27ae60; transform: scale(1.05); }
        .btn-tienda { background: #f1c40f; border-bottom: 5px solid #d4ac0d; color: #000; }

        #ui-juego { position: absolute; top: 10px; left: 20px; color: white; display: none; pointer-events: none; text-shadow: 3px 3px #000; }
        .ammo-bar { color: #ff3333; font-size: 22px; margin-top: 5px; }
        #banco-display { font-size: 30px; color: #f1c40f; background: rgba(0,0,0,0.8); padding: 10px 30px; border-radius: 15px; border: 3px solid #f1c40f; margin-bottom: 20px; box-shadow: 0 0 20px rgba(241, 196, 15, 0.3); }
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="font-size: 80px; color: #ffffff; margin-bottom: 0; text-shadow: 5px 5px #ff3333;">ZOMBIES BR</h1>
        <p style="font-size: 20px; letter-spacing: 5px; margin-top: 0; color: #aaa;">SOBREVIVE A LA HORDA</p>
        
        <div id="banco-display">BANCO: $<span id="banco-total">0</span></div>
        
        <button class="btn" onclick="empezarJuego()">INICIAR PARTIDA</button><br>
        <button class="btn btn-tienda" id="btn-comprar" onclick="equiparAmetralladora()">AMETRALLADORA ($100)</button>
    </div>

    <div id="ui-juego">
        <h2 style="color: gold; font-size: 35px; margin: 0;">PARTIDA: $<span id="puntos">0</span></h2>
        <div id="arma-info" class="ammo-bar">ARMA: Pistola Básica</div>
        <div id="municion-div" class="ammo-bar" style="display:none;">BALAS: <span id="balas-count">200</span> / 200</div>
    </div>

    <canvas id="juego"></canvas>

    <script>
        const canvas = document.getElementById("juego");
        const ctx = canvas.getContext("2d");
        const menu = document.getElementById("menu");
        const ui = document.getElementById("ui-juego");

        // MEMORIA LOCAL (Para que no se pierda el dinero al refrescar)
        let banco = parseInt(localStorage.getItem("zombiesBR_banco")) || 0;
        document.getElementById("banco-total").innerText = banco;

        let enJuego = false;
        let armaEquipada = "pistola"; 
        let jugador, zombies, balas, monedas, teclas, puntosPartida, balasAmetralladora;

        function empezarJuego() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            enJuego = true;
            menu.style.display = "none";
            canvas.style.display = "block";
            ui.style.display = "block";
            
            puntosPartida = 0;
            balasAmetralladora = 200;
            document.getElementById("puntos").innerText = "0";
            
            if(armaEquipada === "ametralladora") {
                document.getElementById("arma-info").innerText = "MODO: Ametralladora Ligera";
                document.getElementById("municion-div").style.display = "block";
                document.getElementById("balas-count").innerText = "200";
            } else {
                document.getElementById("arma-info").innerText = "MODO: Pistola Básica";
                document.getElementById("municion-div").style.display = "none";
            }

            jugador = { x: canvas.width/2, y: canvas.height/2, tam: 30, vel: 5.5 };
            zombies = []; balas = []; monedas = []; teclas = {};
            
            // Generar zombies iniciales
            for(let i=0; i<8; i++) crearZombie();
            requestAnimationFrame(bucle);
        }

        function crearZombie() {
            let lado = Math.floor(Math.random() * 4);
            let x, y;
            if(lado === 0) { x = Math.random()*canvas.width; y = -50; }
            else if(lado === 1) { x = Math.random()*canvas.width; y = canvas.height+50; }
            else if(lado === 2) { x = -50; y = Math.random()*canvas.height; }
            else { x = canvas.width+50; y = Math.random()*canvas.height; }
            
            zombies.push({ x: x, y: y, tam: 40, vel: 2 + Math.random() });
        }

        window.addEventListener("keydown", (e) => teclas[e.key.toLowerCase()] = true);
        window.addEventListener("keyup", (e) => teclas[e.key.toLowerCase()] = false);

        let cooldown = 0;
        window.addEventListener("mousedown", (e) => {
            if(!enJuego) return;
            const ahora = Date.now();
            
            if(armaEquipada === "pistola") {
                if(ahora - cooldown > 350) { 
                    disparar(e, "#ffff00", 12); 
                    cooldown = ahora; 
                }
            } else if(armaEquipada === "ametralladora" && balasAmetralladora > 0) {
                if(ahora - cooldown > 100) { 
                    disparar(e, "#ff3300", 18); 
                    balasAmetralladora--;
                    document.getElementById("balas-count").innerText = balasAmetralladora;
                    cooldown = ahora; 
                    if(balasAmetralladora <= 0) armaEquipada = "pistola";
                }
            }
        });

        function disparar(e, color, fuerza) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            const ang = Math.atan2(mouseY - (jugador.y+15), mouseX - (jugador.x+15));
            balas.push({ 
                x: jugador.x+15, y: jugador.y+15, 
                vx: Math.cos(ang)*fuerza, vy: Math.sin(ang)*fuerza, 
                color: color 
            });
        }

        function actualizar() {
            if(!enJuego) return;

            // Movimiento Jugador
            if (teclas["w"] && jugador.y > 0) jugador.y -= jugador.vel;
            if (teclas["s"] && jugador.y < canvas.height-30) jugador.y += jugador.vel;
            if (teclas["a"] && jugador.x > 0) jugador.x -= jugador.vel;
            if (teclas["d"] && jugador.x < canvas.width-30) jugador.x += jugador.vel;

            // Zombies siguen al jugador
            zombies.forEach((z) => {
                let dx = (jugador.x+15) - (z.x+20);
                let dy = (jugador.y+15) - (z.y+20);
                let dist = Math.sqrt(dx*dx + dy*dy);
                z.x += (dx/dist) * z.vel;
                z.y += (dy/dist) * z.vel;
                if(dist < 30) morir();
            });

            // Balas y Colisiones
            balas.forEach((b, bi) => {
                b.x += b.vx; b.y += b.vy;
                if(b.x < -100 || b.x > canvas.width+100 || b.y < -100 || b.y > canvas.height+100) {
                    balas.splice(bi, 1);
                }
                zombies.forEach((z, zi) => {
                    if(b.x > z.x && b.x < z.x+z.tam && b.y > z.y && b.y < z.y+z.tam) {
                        monedas.push({x: z.x, y: z.y});
                        zombies.splice(zi, 1);
                        balas.splice(bi, 1);
                        crearZombie();
                    }
                });
            });

            // Recoger Monedas
            monedas.forEach((m, mi) => {
                let distM = Math.sqrt(Math.pow(jugador.x-m.x, 2) + Math.pow(jugador.y-m.y, 2));
                if(distM < 50) {
                    puntosPartida += 10;
                    document.getElementById("puntos").innerText = puntosPartida;
                    monedas.splice(mi, 1);
                }
            });
        }

        function dibujar() {
            ctx.fillStyle = "rgba(11, 11, 11, 0.4)"; // Efecto rastro
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar Monedas
            ctx.fillStyle = "gold";
            monedas.forEach(m => {
                ctx.beginPath(); ctx.arc(m.x+20, m.y+20, 8, 0, Math.PI*2); ctx.fill();
            });

            // Dibujar Balas
            balas.forEach(b => {
                ctx.fillStyle = b.color;
                ctx.shadowBlur = 8; ctx.shadowColor = b.color;
                ctx.fillRect(b.x, b.y, 7, 7);
                ctx.shadowBlur = 0;
            });

            // Dibujar Zombies
            ctx.fillStyle = "#ff4444";
            zombies.forEach(z => {
                ctx.fillRect(z.x, z.y, 40, 40);
                ctx.strokeStyle = "white"; ctx.strokeRect(z.x, z.y, 40, 40);
            });

            // Dibujar Jugador
            ctx.fillStyle = "#00aaff";
            ctx.shadowBlur = 15; ctx.shadowColor = "#00aaff";
            ctx.fillRect(jugador.x, jugador.y, 30, 30);
            ctx.shadowBlur = 0;
        }

        function morir() {
            enJuego = false;
            banco += puntosPartida;
            localStorage.setItem("zombiesBR_banco", banco); // Guardar permanentemente
            document.getElementById("banco-total").innerText = banco;
            alert("¡GAME OVER!\nSalvaste: $" + puntosPartida);
            canvas.style.display = "none"; ui.style.display = "none"; menu.style.display = "flex";
            armaEquipada = "pistola";
        }

        function equiparAmetralladora() {
            if(banco >= 100) {
                banco -= 100;
                localStorage.setItem("zombiesBR_banco", banco);
                armaEquipada = "ametralladora";
                document.getElementById("banco-total").innerText = banco;
                alert("¡AMETRALLADORA EQUIPADA!");
            } else {
                alert("¡Necesitas $100 en el banco!");
            }
        }

        function bucle() {
            if(enJuego) {
                actualizar();
                dibujar();
                requestAnimationFrame(bucle);
            }
        }
    </script>
</body>
</html>
