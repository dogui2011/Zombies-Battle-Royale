<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Taming Style PVP - Pro Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: Arial; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; pointer-events: none; }
        #shop { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; color: white; font-weight: bold; transition: 0.2s; }
        .ak47 { background: #d35400; } .sniper { background: #2980b9; } .mg { background: #27ae60; }
        .btn:hover { transform: scale(1.1); }
    </style>
</head>
<body>
    <div id="ui">ORO: $<span id="oro">50</span> | VIDA: <span id="vida">100</span>%</div>
    <div id="shop">
        <button class="btn ak47" onclick="cambiarArma('AK47')">AK-47</button>
        <button class="btn sniper" onclick="cambiarArma('SNIPER')">SNIPER</button>
        <button class="btn mg" onclick="cambiarArma('MG')">AMETRALLADORA</button>
    </div>

    <script src="https://pixijs.download/release/pixi.js"></script>
    <script>
        (async () => {
            const app = new PIXI.Application();
            await app.init({ background: '#1099bb', resizeTo: window, antialias: true });
            document.body.appendChild(app.canvas);

            // OPTIMIZACIÓN: Contenedores separados
            const world = new PIXI.Container();
            app.stage.addChild(world);
            
            // EL JUGADOR (Estilo Taming)
            const player = new PIXI.Container();
            const body = new PIXI.Graphics().circle(0, 0, 25).fill(0xe67e22).stroke({width:3, color:0x000000});
            const hL = new PIXI.Graphics().circle(-30, 15, 8).fill(0xd35400).stroke({width:2, color:0x000000});
            const hR = new PIXI.Graphics().circle(30, 15, 8).fill(0xd35400).stroke({width:2, color:0x000000});
            player.addChild(body, hL, hR);
            player.x = 400; player.y = 300;
            world.addChild(player);

            let oro = 50;
            let vida = 100;
            const keys = {};
            const zombies = [];

            // FIX PAREDES: Límites del mapa
            const MAP_SIZE = 2000;
            const bounds = new PIXI.Graphics().rect(0, 0, MAP_SIZE, MAP_SIZE).stroke({width:10, color:0x000000});
            world.addChild(bounds);

            // CREAR ZOMBIES (Sin que se peguen entre ellos)
            for(let i=0; i<15; i++) {
                const z = new PIXI.Graphics().circle(0, 0, 20).fill(0x2ecc71).stroke({width:3, color:0x000000});
                z.x = Math.random() * MAP_SIZE;
                z.y = Math.random() * MAP_SIZE;
                zombies.push(z);
                world.addChild(z);
            }

            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);

            // BUCLE PRINCIPAL (Game Loop)
            app.ticker.add((delta) => {
                const speed = 5 * delta.deltaTime;
                let nextX = player.x;
                let nextY = player.y;

                if (keys['KeyW']) nextY -= speed;
                if (keys['KeyS']) nextY += speed;
                if (keys['KeyA']) nextX -= speed;
                if (keys['KeyD']) nextX += speed;

                // ANTIPASAR PAREDES
                if (nextX > 25 && nextX < MAP_SIZE - 25) player.x = nextX;
                if (nextY > 25 && nextY < MAP_SIZE - 25) player.y = nextY;

                // CAMARA SIGUE AL JUGADOR
                world.x = -player.x + app.screen.width / 2;
                world.y = -player.y + app.screen.height / 2;

                // LÓGICA DE ZOMBIES ANTI-LAG
                zombies.forEach(z => {
                    const dx = player.x - z.x;
                    const dy = player.y - z.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    
                    if(dist < 500) { // Solo se mueven si estás cerca (Ahorra CPU)
                        z.x += (dx / dist) * 2;
                        z.y += (dy / dist) * 2;
                        
                        // Si te tocan, no se "enciman", rebotan
                        if(dist < 40) {
                            vida -= 0.1;
                            document.getElementById('vida').innerText = Math.max(0, Math.floor(vida));
                        }
                    }
                });
            });

            // ROTACIÓN AL MOUSE
            app.stage.eventMode = 'static';
            app.stage.on('pointermove', (e) => {
                const pos = e.global;
                player.rotation = Math.atan2(pos.y - app.screen.height/2, pos.x - app.screen.width/2) + Math.PI/2;
            });
        })();

        function cambiarArma(tipo) {
            console.log("Arma equipada: " + tipo);
            // Aquí añadiremos el cambio visual después
        }
    </script>
</body>
</html>
