<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Taming IO Replica Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        /* PANTALLA DE INICIO */
        #pantalla-inicio, #pantalla-descanso {
            position: absolute; width: 100%; height: 100%; 
            background: rgba(16, 153, 187, 0.9);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10;
        }
        #pantalla-descanso { display: none; background: rgba(0, 0, 0, 0.8); color: white; }
        
        h1 { color: white; font-size: 50px; text-shadow: 3px 3px #d35400; }
        .btn-play { padding: 20px 60px; font-size: 30px; background: #2ecc71; color: white; border: none; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .btn-play:hover { transform: scale(1.1); background: #27ae60; }

        /* INTERFAZ DE JUEGO */
        #ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; display: none; }
        #shop { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: none; gap: 15px; }
        .arma-btn { padding: 12px 25px; border: 3px solid white; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; }
        .selected { border-color: #f1c40f; transform: translateY(-5px); }
    </style>
</head>
<body>

    <div id="pantalla-inicio">
        <h1>TAMING.IO CLONE</h1>
        <button class="btn-play" onclick="comenzarJuego()">JUGAR</button>
    </div>

    <div id="pantalla-descanso">
        <h1>HAS CAÍDO EN BATALLA</h1>
        <p id="stats-finales">Oro recolectado: $0</p>
        <button class="btn-play" onclick="location.reload()">REINTENTAR</button>
    </div>

    <div id="ui">ORO: $<span id="oro">50</span> | VIDA: <span id="vida">100</span>%</div>
    <div id="shop">
        <button id="btn-AK47" class="arma-btn" style="background: #d35400;" onclick="seleccionarArma('AK47')">AK-47</button>
        <button id="btn-SNIPER" class="arma-btn" style="background: #2980b9;" onclick="seleccionarArma('SNIPER')">SNIPER</button>
        <button id="btn-MG" class="arma-btn" style="background: #27ae60;" onclick="seleccionarArma('MG')">MG</button>
    </div>

    <script src="https://pixijs.download/release/pixi.js"></script>
    <script>
        let juegoIniciado = false;
        let armaActual = 'AK47';
        let oro = 50;
        let vida = 100;

        async function comenzarJuego() {
            document.getElementById('pantalla-inicio').style.display = 'none';
            document.getElementById('ui').style.display = 'block';
            document.getElementById('shop').style.display = 'flex';
            juegoIniciado = true;
            seleccionarArma('AK47');
            await iniciarPixi();
        }

        function seleccionarArma(tipo) {
            armaActual = tipo;
            document.querySelectorAll('.arma-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('btn-' + tipo).classList.add('selected');
        }

        async function iniciarPixi() {
            const app = new PIXI.Application();
            await app.init({ background: '#1099bb', resizeTo: window, antialias: true });
            document.body.appendChild(app.canvas);

            const world = new PIXI.Container();
            app.stage.addChild(world);

            // JUGADOR PRO
            const player = new PIXI.Container();
            const body = new PIXI.Graphics().circle(0, 0, 25).fill(0xe67e22).stroke({width:3, color:0x000000});
            const hL = new PIXI.Graphics().circle(-30, 15, 8).fill(0xd35400).stroke({width:2, color:0x000000});
            const hR = new PIXI.Graphics().circle(30, 15, 8).fill(0xd35400).stroke({width:2, color:0x000000});
            player.addChild(body, hL, hR);
            player.x = 1000; player.y = 1000;
            world.addChild(player);

            // MAPA Y ZOMBIES
            const MAP_SIZE = 3000;
            const zombies = [];
            for(let i=0; i<20; i++) {
                const z = new PIXI.Graphics().circle(0, 0, 22).fill(0x2ecc71).stroke({width:3, color:0x000000});
                z.x = Math.random() * MAP_SIZE; z.y = Math.random() * MAP_SIZE;
                zombies.push(z); world.addChild(z);
            }

            const keys = {};
            window.addEventListener('keydown', (e) => keys[e.code] = true);
            window.addEventListener('keyup', (e) => keys[e.code] = false);

            app.ticker.add((delta) => {
                if(!juegoIniciado || vida <= 0) return;

                // MOVIMIENTO WASD + COLISIONES PARED
                const speed = (armaActual === 'SNIPER' ? 4 : 6) * delta.deltaTime;
                if (keys['KeyW'] && player.y > 30) player.y -= speed;
                if (keys['KeyS'] && player.y < MAP_SIZE - 30) player.y += speed;
                if (keys['KeyA'] && player.x > 30) player.x -= speed;
                if (keys['KeyD'] && player.x < MAP_SIZE - 30) player.x += speed;

                // CAMARA
                world.x = -player.x + app.screen.width / 2;
                world.y = -player.y + app.screen.height / 2;

                // ZOMBIES (Lógica Anti-Lag y Anti-Apegue)
                zombies.forEach(z => {
                    const dx = player.x - z.x;
                    const dy = player.y - z.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    
                    if(dist < 600) {
                        z.x += (dx / dist) * 2;
                        z.y += (dy / dist) * 2;
                        
                        if(dist < 45) { // Daño y rebote para que no se peguen
                            vida -= 0.2;
                            player.x -= (dx / dist) * 5; // Empujón hacia atrás
                            document.getElementById('vida').innerText = Math.max(0, Math.floor(vida));
                            if(vida <= 0) terminarJuego();
                        }
                    }
                });
            });

            // ROTACIÓN AL MOUSE
            app.stage.eventMode = 'static';
            app.stage.on('pointermove', (e) => {
                if(!juegoIniciado) return;
                player.rotation = Math.atan2(e.global.y - app.screen.height/2, e.global.x - app.screen.width/2) + Math.PI/2;
            });
        }

        function terminarJuego() {
            juegoIniciado = false;
            document.getElementById('stats-finales').innerText = `Oro recolectado: $${oro}`;
            document.getElementById('pantalla-descanso').style.display = 'flex';
            document.getElementById('ui').style.display = 'none';
            document.getElementById('shop').style.display = 'none';
        }
    </script>
</body>
</html>
