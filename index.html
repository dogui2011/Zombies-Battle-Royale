<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SURVIVAL IO - MOBILE & PC</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #1a1a1a; font-family: 'Arial Black', sans-serif; touch-action: none; }
        canvas { display: none; background: #2d2d2d; }
        
        #menu { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; color: white; text-align: center; background: #1a1a1a;
        }

        .btn {
            background: #2ecc71; border: none; padding: 12px 30px; color: white;
            font-size: 20px; cursor: pointer; border-radius: 10px; margin: 5px;
            border-bottom: 4px solid #27ae60; width: 280px;
        }

        #ui-juego { position: absolute; top: 10px; left: 20px; color: white; display: none; pointer-events: none; z-index: 10; }
        .stats-box { background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; border: 2px solid #555; }
        #vida-bg { width: 150px; height: 12px; background: #444; border: 1px solid #fff; margin: 5px 0; }
        #vida-bar { width: 100%; height: 100%; background: #ff4444; }

        /* Controles Móviles */
        #touch-controls { position: absolute; bottom: 30px; width: 100%; height: 150px; display: none; pointer-events: none; }
        .joystick-area { position: absolute; left: 30px; bottom: 20px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; pointer-events: auto; }
        .joystick-stick { position: absolute; left: 35px; top: 35px; width: 50px; height: 50px; background: rgba(255,255,255,0.5); border-radius: 50%; }
        #btn-shoot { position: absolute; right: 40px; bottom: 30px; width: 80px; height: 80px; background: rgba(231, 76, 60, 0.7); border-radius: 50%; pointer-events: auto; display: flex; align-it[...]
    </style>
</head>
<body>

    <div id="menu">
        <h1 style="color: #3498db;">ZOMBIE IO</h1>
        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; border: 2px solid #3498db;">
            <h2 style="color: gold;">ORO: $<span id="banco-total">0</span></h2>
            <button class="btn" onclick="empezarJuego()">JUGAR</button>
        </div>
    </div>

    <div id="ui-juego">
        <div class="stats-box">
            <div>ORO: $<span id="puntos">0</span></div>
            <div id="vida-bg"><div id="vida-bar"></div></div>
        </div>
    </div>

    <div id="touch-controls">
        <div class="joystick-area" id="joy-area"><div class="joystick-stick" id="joy-stick"></div></div>
        <div id="btn-shoot">DISPARAR</div>
    </div>

    <canvas id="juego"></canvas>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

    <script>
        const canvas = document.getElementById("juego");
        const ctx = canvas.getContext("2d");
        const MUNDO = 3000;
        let enJuego = false, jugador, zombies = [], balas = [], teclas = {}, camara = {x:0, y:0};
        let banco = parseInt(localStorage.getItem("banco_io")) || 0;
        let joyPos = { x: 0, y: 0 }, isTouching = false;

        document.getElementById("banco-total").innerText = banco;

        function empezarJuego() {
            enJuego = true;
            document.getElementById("menu").style.display = "none";
            canvas.style.display = "block";
            document.getElementById("ui-juego").style.display = "block";
            if('ontouchstart' in window) document.getElementById("touch-controls").style.display = "block";

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            jugador = { x: MUNDO/2, y: MUNDO/2, r: 25, vel: 5, vida: 100, puntos: 0, ang: 0 };
            for(let i=0; i<30; i++) spawnZombie();
            requestAnimationFrame(bucle);
        }

        function spawnZombie() {
            zombies.push({ x: Math.random()*MUNDO, y: Math.random()*MUNDO, r: 25, vel: 2 });
        }

        // --- CONTROLES PC ---
        window.addEventListener("keydown", (e) => teclas[e.key.toLowerCase()] = true);
        window.addEventListener("keyup", (e) => teclas[e.key.toLowerCase()] = false);
        window.addEventListener("mousemove", (e) => {
            if(!enJuego) return;
            jugador.ang = Math.atan2((e.clientY + camara.y) - jugador.y, (e.clientX + camara.x) - jugador.x);
        });

        // --- CONTROLES MÓVIL (Joystick) ---
        const joyArea = document.getElementById("joy-area");
        const joyStick = document.getElementById("joy-stick");
        
        joyArea.addEventListener("touchstart", (e) => { isTouching = true; });
        joyArea.addEventListener("touchmove", (e) => {
            let rect = joyArea.getBoundingClientRect();
            let touch = e.touches[0];
            let dx = touch.clientX - (rect.left + rect.width/2);
            let dy = touch.clientY - (rect.top + rect.height/2);
            let dist = Math.min(40, Math.hypot(dx, dy));
            let ang = Math.atan2(dy, dx);
            
            joyPos.x = Math.cos(ang) * (dist / 40);
            joyPos.y = Math.sin(ang) * (dist / 40);
            
            joyStick.style.transform = `translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px)`;
        });
        joyArea.addEventListener("touchend", () => {
            isTouching = false;
            joyPos = {x:0, y:0};
            joyStick.style.transform = `translate(0px, 0px)`;
        });

        document.getElementById("btn-shoot").addEventListener("touchstart", (e) => {
            teclas["mousedown"] = true;
            e.preventDefault();
        });
        document.getElementById("btn-shoot").addEventListener("touchend", () => teclas["mousedown"] = false);

        function actualizar() {
            // Movimiento PC vs Móvil
            if(isTouching) {
                jugador.x += joyPos.x * jugador.vel;
                jugador.y += joyPos.y * jugador.vel;
                jugador.ang = Math.atan2(joyPos.y, joyPos.x); // Apunta hacia donde camina en móvil
            } else {
                if (teclas["w"]) jugador.y -= jugador.vel;
                if (teclas["s"]) jugador.y += jugador.vel;
                if (teclas["a"]) jugador.x -= jugador.vel;
                if (teclas["d"]) jugador.x += jugador.vel;
            }

            if(teclas["mousedown"] || teclas[" "]) disparar();

            camara.x = jugador.x - canvas.width/2;
            camara.y = jugador.y - canvas.height/2;

            // Zombies
            zombies.forEach(z => {
                let d = Math.hypot(jugador.x - z.x, jugador.y - z.y);
                z.x += (jugador.x - z.x)/d * z.vel;
                z.y += (jugador.y - z.y)/d * z.vel;
                if(d < jugador.r + z.r) {
                    jugador.vida -= 0.5;
                    document.getElementById("vida-bar").style.width = jugador.vida + "%";
                    if(jugador.vida <= 0) location.reload();
                }
            });

            // Balas
            balas.forEach((b, bi) => {
                b.x += b.vx; b.y += b.vy;
                zombies.forEach((z, zi) => {
                    if(Math.hypot(b.x - z.x, b.y - z.y) < z.r) {
                        jugador.puntos += 10;
                        zombies.splice(zi, 1);
                        balas.splice(bi, 1);
                        spawnZombie();
                        document.getElementById("puntos").innerText = jugador.puntos;
                    }
                });
            });
        }

        function disparar() {
            let ahora = Date.now();
            if(!this.lastS) this.lastS = 0;
            if(ahora - this.lastS > 200) {
                balas.push({ x: jugador.x, y: jugador.y, vx: Math.cos(jugador.ang)*15, vy: Math.sin(jugador.ang)*15 });
                this.lastS = ahora;
            }
        }

        function dibujar() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(-camara.x, -camara.y);

            // Suelo
            ctx.fillStyle = "#333"; ctx.fillRect(0,0, MUNDO, MUNDO);
            
            // Zombies
            zombies.forEach(z => {
                ctx.fillStyle = "#ff4757"; ctx.strokeStyle = "#000"; ctx.lineWidth = 4;
                ctx.beginPath(); ctx.arc(z.x, z.y, z.r, 0, Math.PI*2); ctx.fill(); ctx.stroke();
            });

            // Jugador
            ctx.save();
            ctx.translate(jugador.x, jugador.y);
            ctx.rotate(jugador.ang);
            ctx.fillStyle = "#000"; ctx.fillRect(15, -5, 30, 10);
            ctx.restore();

            ctx.fillStyle = "#3498db"; ctx.strokeStyle = "#000"; ctx.lineWidth = 5;
            ctx.beginPath(); ctx.arc(jugador.x, jugador.y, jugador.r, 0, Math.PI*2); ctx.fill(); ctx.stroke();

            // Balas
            balas.forEach(b => {
                ctx.fillStyle = "yellow"; ctx.beginPath(); ctx.arc(b.x, b.y, 5, 0, Math.PI*2); ctx.fill();
            });

            ctx.restore();
        }

        function bucle() { if(enJuego) { actualizar(); dibujar(); requestAnimationFrame(bucle); } }
    </script>
</body>
</html>